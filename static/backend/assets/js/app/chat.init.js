const chatList=document.querySelectorAll("#chatList li"),searchInput=document.querySelector(".form-icon input"),clearChatButton=document.getElementById("clearChat"),profileAvatar=document.getElementById("selectedUserAvatar"),profileName=document.getElementById("selectedUserName"),profileLink=document.getElementById("selectedUserLink"),profileStatus=document.getElementById("selectedUserStatus"),chatInput=document.getElementById("chat-input"),sendButton=document.querySelector(".btn.btn-light"),chatContainer=document.getElementById("chat-list");let currentChatUser=null,selectedImages=[],chatMessages=[{id:1,side:"left",sender:"Lisa Parker",avatar:"/static/assets/images/avatar/avatar-12.jpg",message:"Good morning ðŸ˜Š",time:"02:08 am"},{id:2,side:"right",sender:"Frank Thomas",avatar:"/static/assets/images/avatar/avatar-10.jpg",message:"Hi, I'm having trouble with my recent order. I received the wrong item.",time:"02:09 am"},{id:3,side:"left",sender:"Lisa Parker",avatar:"/static/assets/images/avatar/avatar-12.jpg",message:"I'm really sorry to hear that! Could you please provide me with your order number and describe the item you received?",time:"02:10 am"},{id:4,side:"right",sender:"Frank Thomas",avatar:"/static/assets/images/avatar/avatar-10.jpg",message:"Sure, my order number is #123456. I ordered a red jacket, but I received a blue shirt instead.",time:"02:11 am"},{id:5,side:"left",sender:"Lisa Parker",avatar:"/static/assets/images/avatar/avatar-12.jpg",message:"Thank you for providing the order number. Let me double-check that for you. One moment, please.",time:"02:30 am"},{id:6,side:"left",sender:"Lisa Parker",avatar:"/static/assets/images/avatar/avatar-12.jpg",message:"Here are the images of the items you received:",images:["/static/assets/images/small/img-13.jpg","/static/assets/images/small/img-12.jpg"],time:"03:15 am"},{id:7,side:"right",sender:"Frank Thomas",avatar:"/static/assets/images/avatar/avatar-10.jpg",message:"Yes, please send the red jacket and arrange for the return. How do I return the shirt?",time:"03:50 am"},{id:8,side:"left",sender:"Lisa Parker",avatar:"/static/assets/images/avatar/avatar-12.jpg",message:"Iâ€™ve initiated the replacement order for your red jacket. You should receive it within 3-5 business days.",time:"04:00 am"},{id:9,side:"left",sender:"Lisa Parker",avatar:"/static/assets/images/avatar/avatar-12.jpg",message:"As for the return, Iâ€™ll send you a prepaid return label via email. Just print it and drop off the package at your nearest shipping center.",time:"04:05 am"}];function initApp(){setupEventListeners(),loadChatMessages(),scrollToBottom()}function setupEventListeners(){searchInput.addEventListener("input",handleSearch),clearChatButton.addEventListener("click",handleClearChat),chatList.forEach((e=>{e.addEventListener("click",(()=>selectChat(e)))})),sendButton.addEventListener("click",(e=>{e.preventDefault(),sendMessage()})),chatInput.addEventListener("keypress",(e=>{"Enter"===e.key&&(e.preventDefault(),sendMessage())})),chatInput.addEventListener("focus",showTypingIndicator),chatInput.addEventListener("blur",hideTypingIndicator)}function handleImageSelection(e){const t=e.target.files;if(t&&0!==t.length){selectedImages=[],selectedImagesPreview.innerHTML="";for(let e=0;e<t.length;e++){const a=t[e];if(!a.type.startsWith("image/"))continue;const s=new FileReader;s.onload=function(e){const t=e.target.result;selectedImages.push(t);const a=document.createElement("div");a.className="preview-thumbnail",a.innerHTML=`\n                <img src="${t}" alt="Selected image">\n                <button class="remove-image" data-index="${selectedImages.length-1}">Ã—</button>\n            `,selectedImagesPreview.appendChild(a),a.querySelector(".remove-image").addEventListener("click",(function(){removeSelectedImage(parseInt(this.dataset.index))}))},s.readAsDataURL(a)}selectedImagesPreview.style.display="flex",e.target.value=""}}function removeSelectedImage(e){selectedImages.splice(e,1),updateImagePreview()}function updateImagePreview(){selectedImagesPreview.innerHTML="",0!==selectedImages.length?selectedImages.forEach(((e,t)=>{const a=document.createElement("div");a.className="preview-thumbnail",a.innerHTML=`\n            <img src="${e}" alt="Selected image">\n            <button class="remove-image" data-index="${t}">Ã—</button>\n        `,selectedImagesPreview.appendChild(a),a.querySelector(".remove-image").addEventListener("click",(function(){removeSelectedImage(t)}))})):selectedImagesPreview.style.display="none"}function handleSearch(){const e=searchInput.value.trim().toLowerCase();chatList.forEach((t=>{const a=t.querySelector("h6");if(a){const s=a.textContent.trim().toLowerCase();t.style.display=s.includes(e)?"flex":"none"}}))}function handleClearChat(e){if(e.preventDefault(),confirm("Are you sure you want to clear all messages?")){chatMessages=[],chatContainer.innerHTML="";const e=document.createElement("div");e.className="text-center p-4 text-muted",e.textContent="No messages yet. Start a conversation!",chatContainer.appendChild(e)}}function selectChat(e){const t=e.querySelector(".avatar-wrapper img").src,a=e.querySelector("h6").childNodes[2].textContent.trim(),s=e.dataset.status||"Online";profileAvatar.src=t,profileName.textContent=a,profileLink.textContent=a,profileStatus.textContent=s,currentChatUser={name:a,avatar:t},updateChatMessages(),chatList.forEach((e=>e.classList.remove("active"))),e.classList.add("active");const n=e.querySelector(".badge");n&&(n.style.display="none")}function updateChatMessages(){currentChatUser&&(chatMessages.forEach((e=>{"left"===e.side&&(e.sender=currentChatUser.name,e.avatar=currentChatUser.avatar)})),loadChatMessages())}function loadChatMessages(){if(chatContainer.innerHTML="",0===chatMessages.length){const e=document.createElement("div");return e.className="text-center p-4 text-muted",e.textContent="No messages yet. Start a conversation!",void chatContainer.appendChild(e)}const e=groupMessagesByDate(chatMessages);Object.entries(e).forEach((([e,t])=>{t.forEach((e=>{renderMessage(e)}))}))}function groupMessagesByDate(e){const t={},a=(new Date).toLocaleDateString();return new Date(Date.now()-864e5).toLocaleDateString(),e.forEach((e=>{const s=a;t[s]||(t[s]=[]),t[s].push(e)})),t}function renderMessage(e){const t=document.createElement("li");t.classList.add("chat-list",e.side);let a=`<p class="mb-0 ctext-content">${e.message}</p>`;e.images&&e.images.length>0&&(a+='<div class="message-img-gallery d-flex gap-3">',e.images.forEach((e=>{a+=`\n                <div class="image-wrapper mt-2">\n                    <img src="${e}" class="img-fluid rounded message-img w-176px h-auto" alt="chat image">\n                    <div class="image-actions">\n                        <button class="btn btn-sm bg-body-secondary rounded btn-icon image-action-download position-absolute top-0 end-0 mt-1 me-1" data-src="${e}">\n                            <i class="bi bi-download"></i>\n                        </button>\n                    </div>\n                </div>\n            `})),a+="</div>");const s=`\n        <div class="chat-avatar avatar-wrapper">\n            <img src="${e.avatar}" class="avatar-md rounded-circle" alt="${e.sender}">\n        </div>\n    `;t.innerHTML=`\n        <div class="conversation-list">\n            ${"left"===e.side?s:""}\n            <div class="user-chat-content">\n                <div class="ctext-wrap">\n                    <div class="ctext-wrap-content">\n                        ${a}\n                    </div>\n                </div>\n                <div class="conversation-name">\n                    <small class="text-muted time">${e.time}</small>\n                    <span class="text-success check-message-icon">\n                        <i class="bi bi-check-double"></i>\n                    </span>\n                </div>\n            </div>\n            ${"right"===e.side?s:""}\n        </div>\n    `,chatContainer.appendChild(t),t.querySelectorAll(".image-action-download").forEach((e=>{e.addEventListener("click",(function(){downloadImage(this.dataset.src)}))})),t.querySelectorAll(".image-action-expand").forEach((e=>{e.addEventListener("click",(function(){openImageModal(this.dataset.src)}))}))}function downloadImage(e){const t=document.createElement("a");t.href=e,t.download="chat-image-"+Date.now()+".jpg",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function openImageModal(e){let t=document.getElementById("imageModal");t||(t=document.createElement("div"),t.id="imageModal",t.className="image-modal",t.innerHTML='\n            <div class="image-modal-content">\n                <span class="close-modal">&times;</span>\n                <img id="modalImage" class="modal-img">\n            </div>\n        ',document.body.appendChild(t),t.querySelector(".close-modal").addEventListener("click",(()=>{t.style.display="none"})),t.addEventListener("click",(function(e){e.target===t&&(t.style.display="none")}))),t.querySelector("#modalImage").src=e,t.style.display="flex"}function sendMessage(){const e=chatInput.value.trim();if(""===e&&0===selectedImages.length)return void console.log("Message not sent. Empty message and no images.");currentChatUser||(currentChatUser={name:"Default User",avatar:"/static/assets/images/avatar/avatar-1.jpg"});const t={id:chatMessages.length+1,side:"right",sender:"You",avatar:"/static/assets/images/avatar/avatar-10.jpg",message:e,time:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0})};selectedImages.length>0&&(t.images=[...selectedImages],selectedImages=[],selectedImagesPreview.innerHTML="",selectedImagesPreview.style.display="none"),chatMessages.push(t),loadChatMessages(),scrollToBottom(),chatInput.value=""}function showTypingIndicator(){currentChatUser&&(document.querySelector(".typing-indicator")||chatContainer.appendChild(typingIndicator))}function hideTypingIndicator(){const e=document.querySelector(".typing-indicator");e&&e.remove()}function scrollToBottom(){setTimeout((()=>{const e=chatContainer.lastElementChild;e&&e.scrollIntoView({behavior:"smooth",block:"end"})}),200)}function handleError(e,t){const a=document.createElement("div");a.className="error-toast",a.textContent="Something went wrong. Please try again.",document.body.appendChild(a),setTimeout((()=>{a.remove()}),3e3)}const closeChatSidebar=document.getElementById("close-chat-sidebar"),openChatSidebarSmall=document.getElementById("open-chat-sidebar"),appChatSidebar=document.getElementById("app-chat-sidebar");closeChatSidebar?.addEventListener("click",(()=>{appChatSidebar.classList.remove("active")})),openChatSidebarSmall?.addEventListener("click",(()=>{appChatSidebar.classList.add("active")})),window.addEventListener("resize",(()=>{window.innerWidth>1199&&appChatSidebar.classList.remove("active")})),document.addEventListener("DOMContentLoaded",initApp);