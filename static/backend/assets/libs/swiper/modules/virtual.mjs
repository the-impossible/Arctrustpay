import{g as e}from"../shared/ssr-window.esm.mjs";import{s,e as i,c as t}from"../shared/utils.mjs";function a(a){let r,{swiper:l,extendParams:d,on:n,emit:c}=a;d({virtual:{enabled:!1,slides:[],cache:!0,renderSlide:null,renderExternal:null,renderExternalUpdate:!0,addSlidesBefore:0,addSlidesAfter:0}});const o=e();l.virtual={cache:{},from:void 0,to:void 0,slides:[],offset:0,slidesGrid:[]};const u=o.createElement("div");function p(e,s){const i=l.params.virtual;if(i.cache&&l.virtual.cache[s])return l.virtual.cache[s];let a;return i.renderSlide?(a=i.renderSlide.call(l,e,s),"string"==typeof a&&(u.innerHTML=a,a=u.children[0])):a=l.isElement?t("swiper-slide"):t("div",l.params.slideClass),a.setAttribute("data-swiper-slide-index",s),i.renderSlide||(a.innerHTML=e),i.cache&&(l.virtual.cache[s]=a),a}function h(e,s){const{slidesPerView:t,slidesPerGroup:a,centeredSlides:r,loop:d,initialSlide:n}=l.params;if(s&&!d&&n>0)return;const{addSlidesBefore:o,addSlidesAfter:u}=l.params.virtual,{from:h,to:f,slides:v,slidesGrid:m,offset:g}=l.virtual;l.params.cssMode||l.updateActiveIndex();const x=l.activeIndex||0;let w,E,b;w=l.rtlTranslate?"right":l.isHorizontal()?"left":"top",r?(E=Math.floor(t/2)+a+u,b=Math.floor(t/2)+a+o):(E=t+(a-1)+u,b=(d?t:a)+o);let S=x-b,A=x+E;d||(S=Math.max(S,0),A=Math.min(A,v.length-1));let M=(l.slidesGrid[S]||0)-(l.slidesGrid[0]||0);function y(){l.updateSlides(),l.updateProgress(),l.updateSlidesClasses(),c("virtualUpdate")}if(d&&x>=b?(S-=b,r||(M+=l.slidesGrid[0])):d&&x<b&&(S=-b,r&&(M+=l.slidesGrid[0])),Object.assign(l.virtual,{from:S,to:A,offset:M,slidesGrid:l.slidesGrid,slidesBefore:b,slidesAfter:E}),h===S&&f===A&&!e)return l.slidesGrid!==m&&M!==g&&l.slides.forEach((e=>{e.style[w]=M-Math.abs(l.cssOverflowAdjustment())+"px"})),l.updateProgress(),void c("virtualUpdate");if(l.params.virtual.renderExternal)return l.params.virtual.renderExternal.call(l,{offset:M,from:S,to:A,slides:function(){const e=[];for(let s=S;s<=A;s+=1)e.push(v[s]);return e}()}),void(l.params.virtual.renderExternalUpdate?y():c("virtualUpdate"));const j=[],G=[],P=e=>{let s=e;return e<0?s=v.length+e:s>=v.length&&(s-=v.length),s};if(e)l.slides.filter((e=>e.matches(`.${l.params.slideClass}, swiper-slide`))).forEach((e=>{e.remove()}));else for(let e=h;e<=f;e+=1)if(e<S||e>A){const s=P(e);l.slides.filter((e=>e.matches(`.${l.params.slideClass}[data-swiper-slide-index="${s}"], swiper-slide[data-swiper-slide-index="${s}"]`))).forEach((e=>{e.remove()}))}const T=d?-v.length:0,I=d?2*v.length:v.length;for(let s=T;s<I;s+=1)if(s>=S&&s<=A){const i=P(s);void 0===f||e?G.push(i):(s>f&&G.push(i),s<h&&j.push(i))}if(G.forEach((e=>{l.slidesEl.append(p(v[e],e))})),d)for(let e=j.length-1;e>=0;e-=1){const s=j[e];l.slidesEl.prepend(p(v[s],s))}else j.sort(((e,s)=>s-e)),j.forEach((e=>{l.slidesEl.prepend(p(v[e],e))}));i(l.slidesEl,".swiper-slide, swiper-slide").forEach((e=>{e.style[w]=M-Math.abs(l.cssOverflowAdjustment())+"px"})),y()}n("beforeInit",(()=>{if(!l.params.virtual.enabled)return;let e;if(void 0===l.passedParams.virtual.slides){const s=[...l.slidesEl.children].filter((e=>e.matches(`.${l.params.slideClass}, swiper-slide`)));s&&s.length&&(l.virtual.slides=[...s],e=!0,s.forEach(((e,s)=>{e.setAttribute("data-swiper-slide-index",s),l.virtual.cache[s]=e,e.remove()})))}e||(l.virtual.slides=l.params.virtual.slides),l.classNames.push(`${l.params.containerModifierClass}virtual`),l.params.watchSlidesProgress=!0,l.originalParams.watchSlidesProgress=!0,h(!1,!0)})),n("setTranslate",(()=>{l.params.virtual.enabled&&(l.params.cssMode&&!l._immediateVirtual?(clearTimeout(r),r=setTimeout((()=>{h()}),100)):h())})),n("init update resize",(()=>{l.params.virtual.enabled&&l.params.cssMode&&s(l.wrapperEl,"--swiper-virtual-size",`${l.virtualSize}px`)})),Object.assign(l.virtual,{appendSlide:function(e){if("object"==typeof e&&"length"in e)for(let s=0;s<e.length;s+=1)e[s]&&l.virtual.slides.push(e[s]);else l.virtual.slides.push(e);h(!0)},prependSlide:function(e){const s=l.activeIndex;let i=s+1,t=1;if(Array.isArray(e)){for(let s=0;s<e.length;s+=1)e[s]&&l.virtual.slides.unshift(e[s]);i=s+e.length,t=e.length}else l.virtual.slides.unshift(e);if(l.params.virtual.cache){const e=l.virtual.cache,s={};Object.keys(e).forEach((i=>{const a=e[i],r=a.getAttribute("data-swiper-slide-index");r&&a.setAttribute("data-swiper-slide-index",parseInt(r,10)+t),s[parseInt(i,10)+t]=a})),l.virtual.cache=s}h(!0),l.slideTo(i,0)},removeSlide:function(e){if(null==e)return;let s=l.activeIndex;if(Array.isArray(e))for(let i=e.length-1;i>=0;i-=1)l.params.virtual.cache&&(delete l.virtual.cache[e[i]],Object.keys(l.virtual.cache).forEach((s=>{s>e&&(l.virtual.cache[s-1]=l.virtual.cache[s],l.virtual.cache[s-1].setAttribute("data-swiper-slide-index",s-1),delete l.virtual.cache[s])}))),l.virtual.slides.splice(e[i],1),e[i]<s&&(s-=1),s=Math.max(s,0);else l.params.virtual.cache&&(delete l.virtual.cache[e],Object.keys(l.virtual.cache).forEach((s=>{s>e&&(l.virtual.cache[s-1]=l.virtual.cache[s],l.virtual.cache[s-1].setAttribute("data-swiper-slide-index",s-1),delete l.virtual.cache[s])}))),l.virtual.slides.splice(e,1),e<s&&(s-=1),s=Math.max(s,0);h(!0),l.slideTo(s,0)},removeAllSlides:function(){l.virtual.slides=[],l.params.virtual.cache&&(l.virtual.cache={}),h(!0),l.slideTo(0,0)},update:h})}export{a as default};