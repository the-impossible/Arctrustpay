import{a as e}from"../shared/ssr-window.esm.min.mjs";import{e as t,a as i,b as a,j as r}from"../shared/utils.min.mjs";function s(s){let{swiper:o,extendParams:n,on:l,emit:m}=s;const c=e();n({zoom:{enabled:!1,limitToOriginalSize:!1,maxRatio:3,minRatio:1,toggle:!0,containerClass:"swiper-zoom-container",zoomedSlideClass:"swiper-slide-zoomed"}}),o.zoom={enabled:!1};let d,u,p=1,g=!1;const h=[],v={originX:0,originY:0,slideEl:void 0,slideWidth:void 0,slideHeight:void 0,imageEl:void 0,imageWrapEl:void 0,maxRatio:3},E={isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},f={x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0};let x,y=1;function X(){if(h.length<2)return 1;const e=h[0].pageX,t=h[0].pageY,i=h[1].pageX,a=h[1].pageY;return Math.sqrt((i-e)**2+(a-t)**2)}function Y(){const e=o.params.zoom,t=v.imageWrapEl.getAttribute("data-swiper-zoom")||e.maxRatio;if(e.limitToOriginalSize&&v.imageEl&&v.imageEl.naturalWidth){const e=v.imageEl.naturalWidth/v.imageEl.offsetWidth;return Math.min(e,t)}return t}function z(e){const t=o.isElement?"swiper-slide":`.${o.params.slideClass}`;return!!e.target.matches(t)||o.slides.filter((t=>t.contains(e.target))).length>0}function M(e){if("mouse"===e.pointerType&&h.splice(0,h.length),!z(e))return;const t=o.params.zoom;if(d=!1,u=!1,h.push(e),!(h.length<2)){if(d=!0,v.scaleStart=X(),!v.slideEl){v.slideEl=e.target.closest(`.${o.params.slideClass}, swiper-slide`),v.slideEl||(v.slideEl=o.slides[o.activeIndex]);let a=v.slideEl.querySelector(`.${t.containerClass}`);if(a&&(a=a.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),v.imageEl=a,v.imageWrapEl=a?i(v.imageEl,`.${t.containerClass}`)[0]:void 0,!v.imageWrapEl)return void(v.imageEl=void 0);v.maxRatio=Y()}if(v.imageEl){const[e,t]=function(){if(h.length<2)return{x:null,y:null};const e=v.imageEl.getBoundingClientRect();return[(h[0].pageX+(h[1].pageX-h[0].pageX)/2-e.x-c.scrollX)/p,(h[0].pageY+(h[1].pageY-h[0].pageY)/2-e.y-c.scrollY)/p]}();v.originX=e,v.originY=t,v.imageEl.style.transitionDuration="0ms"}g=!0}}function C(e){if(!z(e))return;const t=o.params.zoom,i=o.zoom,a=h.findIndex((t=>t.pointerId===e.pointerId));a>=0&&(h[a]=e),h.length<2||(u=!0,v.scaleMove=X(),v.imageEl&&(i.scale=v.scaleMove/v.scaleStart*p,i.scale>v.maxRatio&&(i.scale=v.maxRatio-1+(i.scale-v.maxRatio+1)**.5),i.scale<t.minRatio&&(i.scale=t.minRatio+1-(t.minRatio-i.scale+1)**.5),v.imageEl.style.transform=`translate3d(0,0,0) scale(${i.scale})`))}function w(e){if(!z(e))return;if("mouse"===e.pointerType&&"pointerout"===e.type)return;const t=o.params.zoom,i=o.zoom,a=h.findIndex((t=>t.pointerId===e.pointerId));a>=0&&h.splice(a,1),d&&u&&(d=!1,u=!1,v.imageEl&&(i.scale=Math.max(Math.min(i.scale,v.maxRatio),t.minRatio),v.imageEl.style.transitionDuration=`${o.params.speed}ms`,v.imageEl.style.transform=`translate3d(0,0,0) scale(${i.scale})`,p=i.scale,g=!1,i.scale>1&&v.slideEl?v.slideEl.classList.add(`${t.zoomedSlideClass}`):i.scale<=1&&v.slideEl&&v.slideEl.classList.remove(`${t.zoomedSlideClass}`),1===i.scale&&(v.originX=0,v.originY=0,v.slideEl=void 0)))}function W(){o.touchEventsData.preventTouchMoveFromPointerMove=!1}function S(e){if(!z(e)||!function(e){const t=`.${o.params.zoom.containerClass}`;return!!e.target.matches(t)||[...o.hostEl.querySelectorAll(t)].filter((t=>t.contains(e.target))).length>0}(e))return;const t=o.zoom;if(!v.imageEl)return;if(!E.isTouched||!v.slideEl)return;E.isMoved||(E.width=v.imageEl.offsetWidth||v.imageEl.clientWidth,E.height=v.imageEl.offsetHeight||v.imageEl.clientHeight,E.startX=r(v.imageWrapEl,"x")||0,E.startY=r(v.imageWrapEl,"y")||0,v.slideWidth=v.slideEl.offsetWidth,v.slideHeight=v.slideEl.offsetHeight,v.imageWrapEl.style.transitionDuration="0ms");const i=E.width*t.scale,a=E.height*t.scale;if(E.minX=Math.min(v.slideWidth/2-i/2,0),E.maxX=-E.minX,E.minY=Math.min(v.slideHeight/2-a/2,0),E.maxY=-E.minY,E.touchesCurrent.x=h.length>0?h[0].pageX:e.pageX,E.touchesCurrent.y=h.length>0?h[0].pageY:e.pageY,Math.max(Math.abs(E.touchesCurrent.x-E.touchesStart.x),Math.abs(E.touchesCurrent.y-E.touchesStart.y))>5&&(o.allowClick=!1),!E.isMoved&&!g){if(o.isHorizontal()&&(Math.floor(E.minX)===Math.floor(E.startX)&&E.touchesCurrent.x<E.touchesStart.x||Math.floor(E.maxX)===Math.floor(E.startX)&&E.touchesCurrent.x>E.touchesStart.x))return E.isTouched=!1,void W();if(!o.isHorizontal()&&(Math.floor(E.minY)===Math.floor(E.startY)&&E.touchesCurrent.y<E.touchesStart.y||Math.floor(E.maxY)===Math.floor(E.startY)&&E.touchesCurrent.y>E.touchesStart.y))return E.isTouched=!1,void W()}e.cancelable&&e.preventDefault(),e.stopPropagation(),clearTimeout(x),o.touchEventsData.preventTouchMoveFromPointerMove=!0,x=setTimeout((()=>{o.destroyed||W()})),E.isMoved=!0;const s=(t.scale-p)/(v.maxRatio-o.params.zoom.minRatio),{originX:n,originY:l}=v;E.currentX=E.touchesCurrent.x-E.touchesStart.x+E.startX+s*(E.width-2*n),E.currentY=E.touchesCurrent.y-E.touchesStart.y+E.startY+s*(E.height-2*l),E.currentX<E.minX&&(E.currentX=E.minX+1-(E.minX-E.currentX+1)**.8),E.currentX>E.maxX&&(E.currentX=E.maxX-1+(E.currentX-E.maxX+1)**.8),E.currentY<E.minY&&(E.currentY=E.minY+1-(E.minY-E.currentY+1)**.8),E.currentY>E.maxY&&(E.currentY=E.maxY-1+(E.currentY-E.maxY+1)**.8),f.prevPositionX||(f.prevPositionX=E.touchesCurrent.x),f.prevPositionY||(f.prevPositionY=E.touchesCurrent.y),f.prevTime||(f.prevTime=Date.now()),f.x=(E.touchesCurrent.x-f.prevPositionX)/(Date.now()-f.prevTime)/2,f.y=(E.touchesCurrent.y-f.prevPositionY)/(Date.now()-f.prevTime)/2,Math.abs(E.touchesCurrent.x-f.prevPositionX)<2&&(f.x=0),Math.abs(E.touchesCurrent.y-f.prevPositionY)<2&&(f.y=0),f.prevPositionX=E.touchesCurrent.x,f.prevPositionY=E.touchesCurrent.y,f.prevTime=Date.now(),v.imageWrapEl.style.transform=`translate3d(${E.currentX}px, ${E.currentY}px,0)`}function b(){const e=o.zoom;v.slideEl&&o.activeIndex!==o.slides.indexOf(v.slideEl)&&(v.imageEl&&(v.imageEl.style.transform="translate3d(0,0,0) scale(1)"),v.imageWrapEl&&(v.imageWrapEl.style.transform="translate3d(0,0,0)"),v.slideEl.classList.remove(`${o.params.zoom.zoomedSlideClass}`),e.scale=1,p=1,v.slideEl=void 0,v.imageEl=void 0,v.imageWrapEl=void 0,v.originX=0,v.originY=0)}function $(e){const r=o.zoom,s=o.params.zoom;if(!v.slideEl){e&&e.target&&(v.slideEl=e.target.closest(`.${o.params.slideClass}, swiper-slide`)),v.slideEl||(o.params.virtual&&o.params.virtual.enabled&&o.virtual?v.slideEl=t(o.slidesEl,`.${o.params.slideActiveClass}`)[0]:v.slideEl=o.slides[o.activeIndex]);let a=v.slideEl.querySelector(`.${s.containerClass}`);a&&(a=a.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),v.imageEl=a,v.imageWrapEl=a?i(v.imageEl,`.${s.containerClass}`)[0]:void 0}if(!v.imageEl||!v.imageWrapEl)return;let n,l,m,d,u,g,h,f,x,y,X,z,M,C,w,W,S,b;o.params.cssMode&&(o.wrapperEl.style.overflow="hidden",o.wrapperEl.style.touchAction="none"),v.slideEl.classList.add(`${s.zoomedSlideClass}`),void 0===E.touchesStart.x&&e?(n=e.pageX,l=e.pageY):(n=E.touchesStart.x,l=E.touchesStart.y);const $="number"==typeof e?e:null;1===p&&$&&(n=void 0,l=void 0,E.touchesStart.x=void 0,E.touchesStart.y=void 0);const T=Y();r.scale=$||T,p=$||T,!e||1===p&&$?(h=0,f=0):(S=v.slideEl.offsetWidth,b=v.slideEl.offsetHeight,m=a(v.slideEl).left+c.scrollX,d=a(v.slideEl).top+c.scrollY,u=m+S/2-n,g=d+b/2-l,x=v.imageEl.offsetWidth||v.imageEl.clientWidth,y=v.imageEl.offsetHeight||v.imageEl.clientHeight,X=x*r.scale,z=y*r.scale,M=Math.min(S/2-X/2,0),C=Math.min(b/2-z/2,0),w=-M,W=-C,h=u*r.scale,f=g*r.scale,h<M&&(h=M),h>w&&(h=w),f<C&&(f=C),f>W&&(f=W)),$&&1===r.scale&&(v.originX=0,v.originY=0),v.imageWrapEl.style.transitionDuration="300ms",v.imageWrapEl.style.transform=`translate3d(${h}px, ${f}px,0)`,v.imageEl.style.transitionDuration="300ms",v.imageEl.style.transform=`translate3d(0,0,0) scale(${r.scale})`}function T(){const e=o.zoom,a=o.params.zoom;if(!v.slideEl){o.params.virtual&&o.params.virtual.enabled&&o.virtual?v.slideEl=t(o.slidesEl,`.${o.params.slideActiveClass}`)[0]:v.slideEl=o.slides[o.activeIndex];let e=v.slideEl.querySelector(`.${a.containerClass}`);e&&(e=e.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),v.imageEl=e,v.imageWrapEl=e?i(v.imageEl,`.${a.containerClass}`)[0]:void 0}v.imageEl&&v.imageWrapEl&&(o.params.cssMode&&(o.wrapperEl.style.overflow="",o.wrapperEl.style.touchAction=""),e.scale=1,p=1,E.touchesStart.x=void 0,E.touchesStart.y=void 0,v.imageWrapEl.style.transitionDuration="300ms",v.imageWrapEl.style.transform="translate3d(0,0,0)",v.imageEl.style.transitionDuration="300ms",v.imageEl.style.transform="translate3d(0,0,0) scale(1)",v.slideEl.classList.remove(`${a.zoomedSlideClass}`),v.slideEl=void 0,v.originX=0,v.originY=0)}function L(e){const t=o.zoom;t.scale&&1!==t.scale?T():$(e)}function P(){return{passiveListener:!!o.params.passiveListeners&&{passive:!0,capture:!1},activeListenerWithCapture:!o.params.passiveListeners||{passive:!1,capture:!0}}}function D(){const e=o.zoom;if(e.enabled)return;e.enabled=!0;const{passiveListener:t,activeListenerWithCapture:i}=P();o.wrapperEl.addEventListener("pointerdown",M,t),o.wrapperEl.addEventListener("pointermove",C,i),["pointerup","pointercancel","pointerout"].forEach((e=>{o.wrapperEl.addEventListener(e,w,t)})),o.wrapperEl.addEventListener("pointermove",S,i)}function R(){const e=o.zoom;if(!e.enabled)return;e.enabled=!1;const{passiveListener:t,activeListenerWithCapture:i}=P();o.wrapperEl.removeEventListener("pointerdown",M,t),o.wrapperEl.removeEventListener("pointermove",C,i),["pointerup","pointercancel","pointerout"].forEach((e=>{o.wrapperEl.removeEventListener(e,w,t)})),o.wrapperEl.removeEventListener("pointermove",S,i)}Object.defineProperty(o.zoom,"scale",{get:()=>y,set(e){if(y!==e){const t=v.imageEl,i=v.slideEl;m("zoomChange",e,t,i)}y=e}}),l("init",(()=>{o.params.zoom.enabled&&D()})),l("destroy",(()=>{R()})),l("touchStart",((e,t)=>{o.zoom.enabled&&function(e){const t=o.device;if(!v.imageEl)return;if(E.isTouched)return;t.android&&e.cancelable&&e.preventDefault(),E.isTouched=!0;const i=h.length>0?h[0]:e;E.touchesStart.x=i.pageX,E.touchesStart.y=i.pageY}(t)})),l("touchEnd",((e,t)=>{o.zoom.enabled&&function(){const e=o.zoom;if(!v.imageEl)return;if(!E.isTouched||!E.isMoved)return E.isTouched=!1,void(E.isMoved=!1);E.isTouched=!1,E.isMoved=!1;let t=300,i=300;const a=f.x*t,r=E.currentX+a,s=f.y*i,n=E.currentY+s;0!==f.x&&(t=Math.abs((r-E.currentX)/f.x)),0!==f.y&&(i=Math.abs((n-E.currentY)/f.y));const l=Math.max(t,i);E.currentX=r,E.currentY=n;const m=E.width*e.scale,c=E.height*e.scale;E.minX=Math.min(v.slideWidth/2-m/2,0),E.maxX=-E.minX,E.minY=Math.min(v.slideHeight/2-c/2,0),E.maxY=-E.minY,E.currentX=Math.max(Math.min(E.currentX,E.maxX),E.minX),E.currentY=Math.max(Math.min(E.currentY,E.maxY),E.minY),v.imageWrapEl.style.transitionDuration=`${l}ms`,v.imageWrapEl.style.transform=`translate3d(${E.currentX}px, ${E.currentY}px,0)`}()})),l("doubleTap",((e,t)=>{!o.animating&&o.params.zoom.enabled&&o.zoom.enabled&&o.params.zoom.toggle&&L(t)})),l("transitionEnd",(()=>{o.zoom.enabled&&o.params.zoom.enabled&&b()})),l("slideChange",(()=>{o.zoom.enabled&&o.params.zoom.enabled&&o.params.cssMode&&b()})),Object.assign(o.zoom,{enable:D,disable:R,in:$,out:T,toggle:L})}export{s as default};