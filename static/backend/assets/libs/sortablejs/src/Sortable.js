/*! For license information please see Sortable.js.LICENSE.txt */
import{version}from"../package.json";import{IE11OrLess,Edge,FireFox,Safari,IOS,ChromeForAndroid}from"./BrowserInfo.js";import AnimationStateManager from"./Animation.js";import PluginManager from"./PluginManager.js";import dispatchEvent from"./EventDispatcher.js";import{on,off,closest,toggleClass,css,matrix,find,getWindowScrollingElement,getRect,isScrolledPast,getChild,lastChild,index,getRelativeScrollOffset,extend,throttle,scrollBy,clone,expando,getChildContainingRectFromElement,getParentOrHost}from"./utils.js";let pluginEvent=function(t,e,{evt:o,...n}={}){PluginManager.pluginEvent.bind(Sortable)(t,e,{dragEl:dragEl,parentEl:parentEl,ghostEl:ghostEl,rootEl:rootEl,nextEl:nextEl,lastDownEl:lastDownEl,cloneEl:cloneEl,cloneHidden:cloneHidden,dragStarted:moved,putSortable:putSortable,activeSortable:Sortable.active,originalEvent:o,oldIndex:oldIndex,oldDraggableIndex:oldDraggableIndex,newIndex:newIndex,newDraggableIndex:newDraggableIndex,hideGhostForTarget:_hideGhostForTarget,unhideGhostForTarget:_unhideGhostForTarget,cloneNowHidden(){cloneHidden=!0},cloneNowShown(){cloneHidden=!1},dispatchSortableEvent(t){_dispatchEvent({sortable:e,name:t,originalEvent:o})},...n})};function _dispatchEvent(t){dispatchEvent({putSortable:putSortable,cloneEl:cloneEl,targetEl:dragEl,rootEl:rootEl,oldIndex:oldIndex,oldDraggableIndex:oldDraggableIndex,newIndex:newIndex,newDraggableIndex:newDraggableIndex,...t})}let dragEl,parentEl,ghostEl,rootEl,nextEl,lastDownEl,cloneEl,cloneHidden,oldIndex,newIndex,oldDraggableIndex,newDraggableIndex,activeGroup,putSortable,tapEvt,touchEvt,lastDx,lastDy,tapDistanceLeft,tapDistanceTop,moved,lastTarget,lastDirection,targetMoveDistance,ghostRelativeParent,awaitingDragStarted=!1,ignoreNextClick=!1,sortables=[],pastFirstInvertThresh=!1,isCircumstantialInvert=!1,ghostRelativeParentInitialScroll=[],_silent=!1,savedInputChecked=[];const documentExists="undefined"!=typeof document,PositionGhostAbsolutely=IOS,CSSFloatProperty=Edge||IE11OrLess?"cssFloat":"float",supportDraggable=documentExists&&!ChromeForAndroid&&!IOS&&"draggable"in document.createElement("div"),supportCssPointerEvents=function(){if(!documentExists)return;if(IE11OrLess)return!1;let t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}(),_detectDirection=function(t,e){let o=css(t),n=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),a=getChild(t,0,e),l=getChild(t,1,e),r=a&&css(a),i=l&&css(l),s=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+getRect(a).width,d=i&&parseInt(i.marginLeft)+parseInt(i.marginRight)+getRect(l).width;if("flex"===o.display)return"column"===o.flexDirection||"column-reverse"===o.flexDirection?"vertical":"horizontal";if("grid"===o.display)return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&r.float&&"none"!==r.float){let t="left"===r.float?"left":"right";return!l||"both"!==i.clear&&i.clear!==t?"horizontal":"vertical"}return a&&("block"===r.display||"flex"===r.display||"table"===r.display||"grid"===r.display||s>=n&&"none"===o[CSSFloatProperty]||l&&"none"===o[CSSFloatProperty]&&s+d>n)?"vertical":"horizontal"},_dragElInRowColumn=function(t,e,o){let n=o?t.left:t.top,a=o?t.right:t.bottom,l=o?t.width:t.height,r=o?e.left:e.top,i=o?e.right:e.bottom,s=o?e.width:e.height;return n===r||a===i||n+l/2===r+s/2},_detectNearestEmptySortable=function(t,e){let o;return sortables.some((n=>{const a=n[expando].options.emptyInsertThreshold;if(!a||lastChild(n))return;const l=getRect(n),r=t>=l.left-a&&t<=l.right+a,i=e>=l.top-a&&e<=l.bottom+a;return r&&i?o=n:void 0})),o},_prepareGroup=function(t){function e(t,o){return function(n,a,l,r){let i=n.options.group.name&&a.options.group.name&&n.options.group.name===a.options.group.name;if(null==t&&(o||i))return!0;if(null==t||!1===t)return!1;if(o&&"clone"===t)return t;if("function"==typeof t)return e(t(n,a,l,r),o)(n,a,l,r);{let e=(o?n:a).options.group.name;return!0===t||"string"==typeof t&&t===e||t.join&&t.indexOf(e)>-1}}}let o={},n=t.group;n&&"object"==typeof n||(n={name:n}),o.name=n.name,o.checkPull=e(n.pull,!0),o.checkPut=e(n.put),o.revertClone=n.revertClone,t.group=o},_hideGhostForTarget=function(){!supportCssPointerEvents&&ghostEl&&css(ghostEl,"display","none")},_unhideGhostForTarget=function(){!supportCssPointerEvents&&ghostEl&&css(ghostEl,"display","")};documentExists&&!ChromeForAndroid&&document.addEventListener("click",(function(t){if(ignoreNextClick)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),ignoreNextClick=!1,!1}),!0);let nearestEmptyInsertDetectEvent=function(t){if(dragEl){t=t.touches?t.touches[0]:t;let e=_detectNearestEmptySortable(t.clientX,t.clientY);if(e){let o={};for(let e in t)t.hasOwnProperty(e)&&(o[e]=t[e]);o.target=o.rootEl=e,o.preventDefault=void 0,o.stopPropagation=void 0,e[expando]._onDragOver(o)}}},_checkOutsideTargetEl=function(t){dragEl&&dragEl.parentNode[expando]._isOutsideThisEl(t.target)};function Sortable(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw`Sortable: \`el\` must be an HTMLElement, not ${{}.toString.call(t)}`;this.el=t,this.options=e=Object.assign({},e),t[expando]=this;let o={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return _detectDirection(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Sortable.supportPointer&&"PointerEvent"in window&&!Safari,emptyInsertThreshold:5};PluginManager.initializePlugins(this,t,o);for(let t in o)!(t in e)&&(e[t]=o[t]);_prepareGroup(e);for(let t in this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this));this.nativeDraggable=!e.forceFallback&&supportDraggable,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?on(t,"pointerdown",this._onTapStart):(on(t,"mousedown",this._onTapStart),on(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(on(t,"dragover",this),on(t,"dragenter",this)),sortables.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),Object.assign(this,AnimationStateManager())}function _globalDragOver(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function onMove(t,e,o,n,a,l,r,i){let s,d,c=t[expando],g=c.options.onMove;return!window.CustomEvent||IE11OrLess||Edge?(s=document.createEvent("Event"),s.initEvent("move",!0,!0)):s=new CustomEvent("move",{bubbles:!0,cancelable:!0}),s.to=e,s.from=t,s.dragged=o,s.draggedRect=n,s.related=a||e,s.relatedRect=l||getRect(e),s.willInsertAfter=i,s.originalEvent=r,t.dispatchEvent(s),g&&(d=g.call(c,s,r)),d}function _disableDraggable(t){t.draggable=!1}function _unsilent(){_silent=!1}function _ghostIsFirst(t,e,o){let n=getRect(getChild(o.el,0,o.options,!0));const a=getChildContainingRectFromElement(o.el,o.options,ghostEl);return e?t.clientX<a.left-10||t.clientY<n.top&&t.clientX<n.right:t.clientY<a.top-10||t.clientY<n.bottom&&t.clientX<n.left}function _ghostIsLast(t,e,o){const n=getRect(lastChild(o.el,o.options.draggable)),a=getChildContainingRectFromElement(o.el,o.options,ghostEl);return e?t.clientX>a.right+10||t.clientY>n.bottom&&t.clientX>n.left:t.clientY>a.bottom+10||t.clientX>n.right&&t.clientY>n.top}function _getSwapDirection(t,e,o,n,a,l,r,i){let s=n?t.clientY:t.clientX,d=n?o.height:o.width,c=n?o.top:o.left,g=n?o.bottom:o.right,h=!1;if(!r)if(i&&targetMoveDistance<d*a){if(!pastFirstInvertThresh&&(1===lastDirection?s>c+d*l/2:s<g-d*l/2)&&(pastFirstInvertThresh=!0),pastFirstInvertThresh)h=!0;else if(1===lastDirection?s<c+targetMoveDistance:s>g-targetMoveDistance)return-lastDirection}else if(s>c+d*(1-a)/2&&s<g-d*(1-a)/2)return _getInsertDirection(e);return h=h||r,h&&(s<c+d*l/2||s>g-d*l/2)?s>c+d/2?1:-1:0}function _getInsertDirection(t){return index(dragEl)<index(t)?1:-1}function _generateId(t){let e=t.tagName+t.className+t.src+t.href+t.textContent,o=e.length,n=0;for(;o--;)n+=e.charCodeAt(o);return n.toString(36)}function _saveInputCheckedState(t){savedInputChecked.length=0;let e=t.getElementsByTagName("input"),o=e.length;for(;o--;){let t=e[o];t.checked&&savedInputChecked.push(t)}}function _nextTick(t){return setTimeout(t,0)}function _cancelNextTick(t){return clearTimeout(t)}Sortable.prototype={constructor:Sortable,_isOutsideThisEl:function(t){this.el.contains(t)||t===this.el||(lastTarget=null)},_getDirection:function(t,e){return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,dragEl):this.options.direction},_onTapStart:function(t){if(!t.cancelable)return;let e=this,o=this.el,n=this.options,a=n.preventOnFilter,l=t.type,r=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,i=(r||t).target,s=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||i,d=n.filter;if(_saveInputCheckedState(o),!dragEl&&!(/mousedown|pointerdown/.test(l)&&0!==t.button||n.disabled)&&!s.isContentEditable&&(this.nativeDraggable||!Safari||!i||"SELECT"!==i.tagName.toUpperCase())&&(i=closest(i,n.draggable,o,!1),!(i&&i.animated||lastDownEl===i))){if(oldIndex=index(i),oldDraggableIndex=index(i,n.draggable),"function"==typeof d){if(d.call(this,t,i,this))return _dispatchEvent({sortable:e,rootEl:s,name:"filter",targetEl:i,toEl:o,fromEl:o}),pluginEvent("filter",e,{evt:t}),void(a&&t.cancelable&&t.preventDefault())}else if(d&&(d=d.split(",").some((function(n){if(n=closest(s,n.trim(),o,!1))return _dispatchEvent({sortable:e,rootEl:n,name:"filter",targetEl:i,fromEl:o,toEl:o}),pluginEvent("filter",e,{evt:t}),!0})),d))return void(a&&t.cancelable&&t.preventDefault());n.handle&&!closest(s,n.handle,o,!1)||this._prepareDragStart(t,r,i)}},_prepareDragStart:function(t,e,o){let n,a=this,l=a.el,r=a.options,i=l.ownerDocument;if(o&&!dragEl&&o.parentNode===l){let s=getRect(o);if(rootEl=l,dragEl=o,parentEl=dragEl.parentNode,nextEl=dragEl.nextSibling,lastDownEl=o,activeGroup=r.group,Sortable.dragged=dragEl,tapEvt={target:dragEl,clientX:(e||t).clientX,clientY:(e||t).clientY},tapDistanceLeft=tapEvt.clientX-s.left,tapDistanceTop=tapEvt.clientY-s.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,dragEl.style["will-change"]="all",n=function(){pluginEvent("delayEnded",a,{evt:t}),Sortable.eventCanceled?a._onDrop():(a._disableDelayedDragEvents(),!FireFox&&a.nativeDraggable&&(dragEl.draggable=!0),a._triggerDragStart(t,e),_dispatchEvent({sortable:a,name:"choose",originalEvent:t}),toggleClass(dragEl,r.chosenClass,!0))},r.ignore.split(",").forEach((function(t){find(dragEl,t.trim(),_disableDraggable)})),on(i,"dragover",nearestEmptyInsertDetectEvent),on(i,"mousemove",nearestEmptyInsertDetectEvent),on(i,"touchmove",nearestEmptyInsertDetectEvent),on(i,"mouseup",a._onDrop),on(i,"touchend",a._onDrop),on(i,"touchcancel",a._onDrop),FireFox&&this.nativeDraggable&&(this.options.touchStartThreshold=4,dragEl.draggable=!0),pluginEvent("delayStart",this,{evt:t}),!r.delay||r.delayOnTouchOnly&&!e||this.nativeDraggable&&(Edge||IE11OrLess))n();else{if(Sortable.eventCanceled)return void this._onDrop();on(i,"mouseup",a._disableDelayedDrag),on(i,"touchend",a._disableDelayedDrag),on(i,"touchcancel",a._disableDelayedDrag),on(i,"mousemove",a._delayedDragTouchMoveHandler),on(i,"touchmove",a._delayedDragTouchMoveHandler),r.supportPointer&&on(i,"pointermove",a._delayedDragTouchMoveHandler),a._dragStartTimer=setTimeout(n,r.delay)}}},_delayedDragTouchMoveHandler:function(t){let e=t.touches?t.touches[0]:t;Math.max(Math.abs(e.clientX-this._lastX),Math.abs(e.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){dragEl&&_disableDraggable(dragEl),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){let t=this.el.ownerDocument;off(t,"mouseup",this._disableDelayedDrag),off(t,"touchend",this._disableDelayedDrag),off(t,"touchcancel",this._disableDelayedDrag),off(t,"mousemove",this._delayedDragTouchMoveHandler),off(t,"touchmove",this._delayedDragTouchMoveHandler),off(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||"touch"==t.pointerType&&t,!this.nativeDraggable||e?this.options.supportPointer?on(document,"pointermove",this._onTouchMove):on(document,e?"touchmove":"mousemove",this._onTouchMove):(on(dragEl,"dragend",this),on(rootEl,"dragstart",this._onDragStart));try{document.selection?_nextTick((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(t,e){if(awaitingDragStarted=!1,rootEl&&dragEl){pluginEvent("dragStarted",this,{evt:e}),this.nativeDraggable&&on(document,"dragover",_checkOutsideTargetEl);let o=this.options;!t&&toggleClass(dragEl,o.dragClass,!1),toggleClass(dragEl,o.ghostClass,!0),Sortable.active=this,t&&this._appendGhost(),_dispatchEvent({sortable:this,name:"start",originalEvent:e})}else this._nulling()},_emulateDragOver:function(){if(touchEvt){this._lastX=touchEvt.clientX,this._lastY=touchEvt.clientY,_hideGhostForTarget();let t=document.elementFromPoint(touchEvt.clientX,touchEvt.clientY),e=t;for(;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(touchEvt.clientX,touchEvt.clientY),t!==e);)e=t;if(dragEl.parentNode[expando]._isOutsideThisEl(t),e)do{if(e[expando]){let o;if(o=e[expando]._onDragOver({clientX:touchEvt.clientX,clientY:touchEvt.clientY,target:t,rootEl:e}),o&&!this.options.dragoverBubble)break}t=e}while(e=getParentOrHost(e));_unhideGhostForTarget()}},_onTouchMove:function(t){if(tapEvt){let e=this.options,o=e.fallbackTolerance,n=e.fallbackOffset,a=t.touches?t.touches[0]:t,l=ghostEl&&matrix(ghostEl,!0),r=ghostEl&&l&&l.a,i=ghostEl&&l&&l.d,s=PositionGhostAbsolutely&&ghostRelativeParent&&getRelativeScrollOffset(ghostRelativeParent),d=(a.clientX-tapEvt.clientX+n.x)/(r||1)+(s?s[0]-ghostRelativeParentInitialScroll[0]:0)/(r||1),c=(a.clientY-tapEvt.clientY+n.y)/(i||1)+(s?s[1]-ghostRelativeParentInitialScroll[1]:0)/(i||1);if(!Sortable.active&&!awaitingDragStarted){if(o&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<o)return;this._onDragStart(t,!0)}if(ghostEl){l?(l.e+=d-(lastDx||0),l.f+=c-(lastDy||0)):l={a:1,b:0,c:0,d:1,e:d,f:c};let t=`matrix(${l.a},${l.b},${l.c},${l.d},${l.e},${l.f})`;css(ghostEl,"webkitTransform",t),css(ghostEl,"mozTransform",t),css(ghostEl,"msTransform",t),css(ghostEl,"transform",t),lastDx=d,lastDy=c,touchEvt=a}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!ghostEl){let t=this.options.fallbackOnBody?document.body:rootEl,e=getRect(dragEl,!0,PositionGhostAbsolutely,!0,t),o=this.options;if(PositionGhostAbsolutely){for(ghostRelativeParent=t;"static"===css(ghostRelativeParent,"position")&&"none"===css(ghostRelativeParent,"transform")&&ghostRelativeParent!==document;)ghostRelativeParent=ghostRelativeParent.parentNode;ghostRelativeParent!==document.body&&ghostRelativeParent!==document.documentElement?(ghostRelativeParent===document&&(ghostRelativeParent=getWindowScrollingElement()),e.top+=ghostRelativeParent.scrollTop,e.left+=ghostRelativeParent.scrollLeft):ghostRelativeParent=getWindowScrollingElement(),ghostRelativeParentInitialScroll=getRelativeScrollOffset(ghostRelativeParent)}ghostEl=dragEl.cloneNode(!0),toggleClass(ghostEl,o.ghostClass,!1),toggleClass(ghostEl,o.fallbackClass,!0),toggleClass(ghostEl,o.dragClass,!0),css(ghostEl,"transition",""),css(ghostEl,"transform",""),css(ghostEl,"box-sizing","border-box"),css(ghostEl,"margin",0),css(ghostEl,"top",e.top),css(ghostEl,"left",e.left),css(ghostEl,"width",e.width),css(ghostEl,"height",e.height),css(ghostEl,"opacity","0.8"),css(ghostEl,"position",PositionGhostAbsolutely?"absolute":"fixed"),css(ghostEl,"zIndex","100000"),css(ghostEl,"pointerEvents","none"),Sortable.ghost=ghostEl,t.appendChild(ghostEl),css(ghostEl,"transform-origin",tapDistanceLeft/parseInt(ghostEl.style.width)*100+"% "+tapDistanceTop/parseInt(ghostEl.style.height)*100+"%")}},_onDragStart:function(t,e){let o=this,n=t.dataTransfer,a=o.options;pluginEvent("dragStart",this,{evt:t}),Sortable.eventCanceled?this._onDrop():(pluginEvent("setupClone",this),Sortable.eventCanceled||(cloneEl=clone(dragEl),cloneEl.removeAttribute("id"),cloneEl.draggable=!1,cloneEl.style["will-change"]="",this._hideClone(),toggleClass(cloneEl,this.options.chosenClass,!1),Sortable.clone=cloneEl),o.cloneId=_nextTick((function(){pluginEvent("clone",o),Sortable.eventCanceled||(o.options.removeCloneOnHide||rootEl.insertBefore(cloneEl,dragEl),o._hideClone(),_dispatchEvent({sortable:o,name:"clone"}))})),!e&&toggleClass(dragEl,a.dragClass,!0),e?(ignoreNextClick=!0,o._loopId=setInterval(o._emulateDragOver,50)):(off(document,"mouseup",o._onDrop),off(document,"touchend",o._onDrop),off(document,"touchcancel",o._onDrop),n&&(n.effectAllowed="move",a.setData&&a.setData.call(o,n,dragEl)),on(document,"drop",o),css(dragEl,"transform","translateZ(0)")),awaitingDragStarted=!0,o._dragStartId=_nextTick(o._dragStarted.bind(o,e,t)),on(document,"selectstart",o),moved=!0,Safari&&css(document.body,"user-select","none"))},_onDragOver:function(t){let e,o,n,a,l=this.el,r=t.target,i=this.options,s=i.group,d=Sortable.active,c=activeGroup===s,g=i.sort,h=putSortable||d,p=this,u=!1;if(!_silent){if(void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),r=closest(r,i.draggable,l,!0),E("dragOver"),Sortable.eventCanceled)return u;if(dragEl.contains(t.target)||r.animated&&r.animatingX&&r.animatingY||p._ignoreWhileAnimating===r)return v(!1);if(ignoreNextClick=!1,d&&!i.disabled&&(c?g||(n=parentEl!==rootEl):putSortable===this||(this.lastPutMode=activeGroup.checkPull(this,d,dragEl,t))&&s.checkPut(this,d,dragEl,t))){if(a="vertical"===this._getDirection(t,r),e=getRect(dragEl),E("dragOverValid"),Sortable.eventCanceled)return u;if(n)return parentEl=rootEl,f(),this._hideClone(),E("revert"),Sortable.eventCanceled||(nextEl?rootEl.insertBefore(dragEl,nextEl):rootEl.appendChild(dragEl)),v(!0);let s=lastChild(l,i.draggable);if(!s||_ghostIsLast(t,a,this)&&!s.animated){if(s===dragEl)return v(!1);if(s&&l===t.target&&(r=s),r&&(o=getRect(r)),!1!==onMove(rootEl,l,dragEl,e,r,o,t,!!r))return f(),s&&s.nextSibling?l.insertBefore(dragEl,s.nextSibling):l.appendChild(dragEl),parentEl=l,m(),v(!0)}else if(s&&_ghostIsFirst(t,a,this)){let n=getChild(l,0,i,!0);if(n===dragEl)return v(!1);if(r=n,o=getRect(r),!1!==onMove(rootEl,l,dragEl,e,r,o,t,!1))return f(),l.insertBefore(dragEl,n),parentEl=l,m(),v(!0)}else if(r.parentNode===l){o=getRect(r);let n,s,d=0,c=dragEl.parentNode!==l,g=!_dragElInRowColumn(dragEl.animated&&dragEl.toRect||e,r.animated&&r.toRect||o,a),h=a?"top":"left",p=isScrolledPast(r,"top","top")||isScrolledPast(dragEl,"top","top"),u=p?p.scrollTop:void 0;if(lastTarget!==r&&(n=o[h],pastFirstInvertThresh=!1,isCircumstantialInvert=!g&&i.invertSwap||c),d=_getSwapDirection(t,r,o,a,g?1:i.swapThreshold,null==i.invertedSwapThreshold?i.swapThreshold:i.invertedSwapThreshold,isCircumstantialInvert,lastTarget===r),0!==d){let t=index(dragEl);do{t-=d,s=parentEl.children[t]}while(s&&("none"===css(s,"display")||s===ghostEl))}if(0===d||s===r)return v(!1);lastTarget=r,lastDirection=d;let E=r.nextElementSibling,b=!1;b=1===d;let D=onMove(rootEl,l,dragEl,e,r,o,t,b);if(!1!==D)return 1!==D&&-1!==D||(b=1===D),_silent=!0,setTimeout(_unsilent,30),f(),b&&!E?l.appendChild(dragEl):r.parentNode.insertBefore(dragEl,b?E:r),p&&scrollBy(p,0,u-p.scrollTop),parentEl=dragEl.parentNode,void 0===n||isCircumstantialInvert||(targetMoveDistance=Math.abs(n-getRect(r)[h])),m(),v(!0)}if(l.contains(dragEl))return v(!1)}return!1}function E(i,s){pluginEvent(i,p,{evt:t,isOwner:c,axis:a?"vertical":"horizontal",revert:n,dragRect:e,targetRect:o,canSort:g,fromSortable:h,target:r,completed:v,onMove(o,n){return onMove(rootEl,l,dragEl,e,o,getRect(o),t,n)},changed:m,...s})}function f(){E("dragOverAnimationCapture"),p.captureAnimationState(),p!==h&&h.captureAnimationState()}function v(e){return E("dragOverCompleted",{insertion:e}),e&&(c?d._hideClone():d._showClone(p),p!==h&&(toggleClass(dragEl,putSortable?putSortable.options.ghostClass:d.options.ghostClass,!1),toggleClass(dragEl,i.ghostClass,!0)),putSortable!==p&&p!==Sortable.active?putSortable=p:p===Sortable.active&&putSortable&&(putSortable=null),h===p&&(p._ignoreWhileAnimating=r),p.animateAll((function(){E("dragOverAnimationComplete"),p._ignoreWhileAnimating=null})),p!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(r===dragEl&&!dragEl.animated||r===l&&!r.animated)&&(lastTarget=null),i.dragoverBubble||t.rootEl||r===document||(dragEl.parentNode[expando]._isOutsideThisEl(t.target),!e&&nearestEmptyInsertDetectEvent(t)),!i.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),u=!0}function m(){newIndex=index(dragEl),newDraggableIndex=index(dragEl,i.draggable),_dispatchEvent({sortable:p,name:"change",toEl:l,newIndex:newIndex,newDraggableIndex:newDraggableIndex,originalEvent:t})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){off(document,"mousemove",this._onTouchMove),off(document,"touchmove",this._onTouchMove),off(document,"pointermove",this._onTouchMove),off(document,"dragover",nearestEmptyInsertDetectEvent),off(document,"mousemove",nearestEmptyInsertDetectEvent),off(document,"touchmove",nearestEmptyInsertDetectEvent)},_offUpEvents:function(){let t=this.el.ownerDocument;off(t,"mouseup",this._onDrop),off(t,"touchend",this._onDrop),off(t,"pointerup",this._onDrop),off(t,"touchcancel",this._onDrop),off(document,"selectstart",this)},_onDrop:function(t){let e=this.el,o=this.options;newIndex=index(dragEl),newDraggableIndex=index(dragEl,o.draggable),pluginEvent("drop",this,{evt:t}),parentEl=dragEl&&dragEl.parentNode,newIndex=index(dragEl),newDraggableIndex=index(dragEl,o.draggable),Sortable.eventCanceled||(awaitingDragStarted=!1,isCircumstantialInvert=!1,pastFirstInvertThresh=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),_cancelNextTick(this.cloneId),_cancelNextTick(this._dragStartId),this.nativeDraggable&&(off(document,"drop",this),off(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Safari&&css(document.body,"user-select",""),css(dragEl,"transform",""),t&&(moved&&(t.cancelable&&t.preventDefault(),!o.dropBubble&&t.stopPropagation()),ghostEl&&ghostEl.parentNode&&ghostEl.parentNode.removeChild(ghostEl),(rootEl===parentEl||putSortable&&"clone"!==putSortable.lastPutMode)&&cloneEl&&cloneEl.parentNode&&cloneEl.parentNode.removeChild(cloneEl),dragEl&&(this.nativeDraggable&&off(dragEl,"dragend",this),_disableDraggable(dragEl),dragEl.style["will-change"]="",moved&&!awaitingDragStarted&&toggleClass(dragEl,putSortable?putSortable.options.ghostClass:this.options.ghostClass,!1),toggleClass(dragEl,this.options.chosenClass,!1),_dispatchEvent({sortable:this,name:"unchoose",toEl:parentEl,newIndex:null,newDraggableIndex:null,originalEvent:t}),rootEl!==parentEl?(newIndex>=0&&(_dispatchEvent({rootEl:parentEl,name:"add",toEl:parentEl,fromEl:rootEl,originalEvent:t}),_dispatchEvent({sortable:this,name:"remove",toEl:parentEl,originalEvent:t}),_dispatchEvent({rootEl:parentEl,name:"sort",toEl:parentEl,fromEl:rootEl,originalEvent:t}),_dispatchEvent({sortable:this,name:"sort",toEl:parentEl,originalEvent:t})),putSortable&&putSortable.save()):newIndex!==oldIndex&&newIndex>=0&&(_dispatchEvent({sortable:this,name:"update",toEl:parentEl,originalEvent:t}),_dispatchEvent({sortable:this,name:"sort",toEl:parentEl,originalEvent:t})),Sortable.active&&(null!=newIndex&&-1!==newIndex||(newIndex=oldIndex,newDraggableIndex=oldDraggableIndex),_dispatchEvent({sortable:this,name:"end",toEl:parentEl,originalEvent:t}),this.save())))),this._nulling()},_nulling:function(){pluginEvent("nulling",this),rootEl=dragEl=parentEl=ghostEl=nextEl=cloneEl=lastDownEl=cloneHidden=tapEvt=touchEvt=moved=newIndex=newDraggableIndex=oldIndex=oldDraggableIndex=lastTarget=lastDirection=putSortable=activeGroup=Sortable.dragged=Sortable.ghost=Sortable.clone=Sortable.active=null,savedInputChecked.forEach((function(t){t.checked=!0})),savedInputChecked.length=lastDx=lastDy=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":dragEl&&(this._onDragOver(t),_globalDragOver(t));break;case"selectstart":t.preventDefault()}},toArray:function(){let t,e=[],o=this.el.children,n=0,a=o.length,l=this.options;for(;n<a;n++)t=o[n],closest(t,l.draggable,this.el,!1)&&e.push(t.getAttribute(l.dataIdAttr)||_generateId(t));return e},sort:function(t,e){let o={},n=this.el;this.toArray().forEach((function(t,e){let a=n.children[e];closest(a,this.options.draggable,n,!1)&&(o[t]=a)}),this),e&&this.captureAnimationState(),t.forEach((function(t){o[t]&&(n.removeChild(o[t]),n.appendChild(o[t]))})),e&&this.animateAll()},save:function(){let t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return closest(t,e||this.options.draggable,this.el,!1)},option:function(t,e){let o=this.options;if(void 0===e)return o[t];{let n=PluginManager.modifyOption(this,t,e);o[t]=void 0!==n?n:e,"group"===t&&_prepareGroup(o)}},destroy:function(){pluginEvent("destroy",this);let t=this.el;t[expando]=null,off(t,"mousedown",this._onTapStart),off(t,"touchstart",this._onTapStart),off(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(off(t,"dragover",this),off(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),(function(t){t.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),sortables.splice(sortables.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!cloneHidden){if(pluginEvent("hideClone",this),Sortable.eventCanceled)return;css(cloneEl,"display","none"),this.options.removeCloneOnHide&&cloneEl.parentNode&&cloneEl.parentNode.removeChild(cloneEl),cloneHidden=!0}},_showClone:function(t){if("clone"===t.lastPutMode){if(cloneHidden){if(pluginEvent("showClone",this),Sortable.eventCanceled)return;dragEl.parentNode!=rootEl||this.options.group.revertClone?nextEl?rootEl.insertBefore(cloneEl,nextEl):rootEl.appendChild(cloneEl):rootEl.insertBefore(cloneEl,dragEl),this.options.group.revertClone&&this.animate(dragEl,cloneEl),css(cloneEl,"display",""),cloneHidden=!1}}else this._hideClone()}},documentExists&&on(document,"touchmove",(function(t){(Sortable.active||awaitingDragStarted)&&t.cancelable&&t.preventDefault()})),Sortable.utils={on:on,off:off,css:css,find:find,is:function(t,e){return!!closest(t,e,t,!1)},extend:extend,throttle:throttle,closest:closest,toggleClass:toggleClass,clone:clone,index:index,nextTick:_nextTick,cancelNextTick:_cancelNextTick,detectDirection:_detectDirection,getChild:getChild,expando:expando},Sortable.get=function(t){return t[expando]},Sortable.mount=function(...t){t[0].constructor===Array&&(t=t[0]),t.forEach((t=>{if(!t.prototype||!t.prototype.constructor)throw`Sortable: Mounted plugin must be a constructor function, not ${{}.toString.call(t)}`;t.utils&&(Sortable.utils={...Sortable.utils,...t.utils}),PluginManager.mount(t)}))},Sortable.create=function(t,e){return new Sortable(t,e)},Sortable.version=version;export default Sortable;