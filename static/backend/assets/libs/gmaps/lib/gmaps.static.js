GMaps.prototype.toImage=function(e){e=e||{};var t={};if(t.size=e.size||[this.el.clientWidth,this.el.clientHeight],t.lat=this.getCenter().lat(),t.lng=this.getCenter().lng(),this.markers.length>0){t.markers=[];for(var r=0;r<this.markers.length;r++)t.markers.push({lat:this.markers[r].getPosition().lat(),lng:this.markers[r].getPosition().lng()})}if(this.polylines.length>0){var s=this.polylines[0];t.polyline={},t.polyline.path=google.maps.geometry.encoding.encodePath(s.getPath()),t.polyline.strokeColor=s.strokeColor,t.polyline.strokeOpacity=s.strokeOpacity,t.polyline.strokeWeight=s.strokeWeight}return GMaps.staticMapURL(t)},GMaps.staticMapURL=function(e){var t,r=[],s=("file:"===location.protocol?"http:":location.protocol)+"//maps.googleapis.com/maps/api/staticmap";e.url&&(s=e.url,delete e.url),s+="?";var l=e.markers;delete e.markers,!l&&e.marker&&(l=[e.marker],delete e.marker);var o=e.styles;delete e.styles;var i=e.polyline;if(delete e.polyline,e.center)r.push("center="+e.center),delete e.center;else if(e.address)r.push("center="+e.address),delete e.address;else if(e.lat)r.push(["center=",e.lat,",",e.lng].join("")),delete e.lat,delete e.lng;else if(e.visible){var a=encodeURI(e.visible.join("|"));r.push("visible="+a)}var n=e.size;n?(n.join&&(n=n.join("x")),delete e.size):n="630x300",r.push("size="+n),e.zoom||!1===e.zoom||(e.zoom=15);var p=!e.hasOwnProperty("sensor")||!!e.sensor;for(var h in delete e.sensor,r.push("sensor="+p),e)e.hasOwnProperty(h)&&r.push(h+"="+e[h]);if(l)for(var c,u,d=0;t=l[d];d++){for(var h in c=[],t.size&&"normal"!==t.size?(c.push("size:"+t.size),delete t.size):t.icon&&(c.push("icon:"+encodeURI(t.icon)),delete t.icon),t.color&&(c.push("color:"+t.color.replace("#","0x")),delete t.color),t.label&&(c.push("label:"+t.label[0].toUpperCase()),delete t.label),u=t.address?t.address:t.lat+","+t.lng,delete t.address,delete t.lat,delete t.lng,t)t.hasOwnProperty(h)&&c.push(h+":"+t[h]);c.length||0===d?(c.push(u),c=c.join("|"),r.push("markers="+encodeURI(c))):(c=r.pop()+encodeURI("|"+u),r.push(c))}if(o)for(d=0;d<o.length;d++){var g=[];o[d].featureType&&g.push("feature:"+o[d].featureType.toLowerCase()),o[d].elementType&&g.push("element:"+o[d].elementType.toLowerCase());for(var f=0;f<o[d].stylers.length;f++)for(var m in o[d].stylers[f]){var y=o[d].stylers[f][m];"hue"!=m&&"color"!=m||(y="0x"+y.substring(1)),g.push(m+":"+y)}var v=g.join("|");""!=v&&r.push("style="+v)}function k(e,t){if("#"===e[0]&&(e=e.replace("#","0x"),t)){if(t=parseFloat(t),0===(t=Math.min(1,Math.max(t,0))))return"0x00000000";1===(t=(255*t).toString(16)).length&&(t+=t),e=e.slice(0,8)+t}return e}if(i){if(t=i,i=[],t.strokeWeight&&i.push("weight:"+parseInt(t.strokeWeight,10)),t.strokeColor){var z=k(t.strokeColor,t.strokeOpacity);i.push("color:"+z)}if(t.fillColor){var C=k(t.fillColor,t.fillOpacity);i.push("fillcolor:"+C)}var j,b=t.path;if(b.join)for(f=0;j=b[f];f++)i.push(j.join(","));else i.push("enc:"+b);i=i.join("|"),r.push("path="+encodeURI(i))}var w=window.devicePixelRatio||1;return r.push("scale="+w),s+r.join("&")};