describe("Creating event listeners",(function(){var e,o,n,t,l,c,a,i,d,r,s,p,u,g,f;beforeEach((function(){e=e||new GMaps({el:"#map-with-events",lat:-12.0433,lng:-77.0283,zoom:12}),o=o||e.addMarker({lat:-12.0433,lng:-77.0283,title:"New marker"}),n=n||e.drawPolyline({path:[[-12.044,-77.0247],[-12.0544,-77.0302],[-12.0551,-77.0303],[-12.0759,-77.0276],[-12.0763,-77.0279],[-12.0768,-77.0289],[-12.0885,-77.0241],[-12.0908,-77.0227]],strokeColor:"#131540",strokeOpacity:.6,strokeWeight:6}),t=t||e.drawPolygon({paths:[[-12.0403,-77.0337],[-12.0402,-77.0399],[-12.05,-77.0244],[-12.0448,-77.0215]],strokeColor:"#25D359",strokeOpacity:1,strokeWeight:3,fillColor:"#25D359",fillOpacity:.6})})),describe("for google.maps events",(function(){beforeEach((function(){l=l||{map:{onclick:function(){console.log("callbacks_native.map.onclick")}},marker:{onclick:function(){console.log("callbacks_native.marker.onclick")}},line:{onclick:function(){console.log("callbacks_native.line.onclick")}},polygon:{onclick:function(){console.log("callbacks_native.polygon.onclick")}}},spyOn(l.map,"onclick").and.callThrough(),spyOn(l.marker,"onclick").and.callThrough(),spyOn(l.line,"onclick").and.callThrough(),spyOn(l.polygon,"onclick").and.callThrough()})),describe("To a map",(function(){it("should add the listener to the listeners collection",(function(){var o=GMaps.on("click",e.map,l.map.onclick);expect(e.map.__e3_.click[o.id]).toBeDefined(),expect(e.map.__e3_.click[o.id]).toEqual(o)}))})),describe("To a marker",(function(){it("should add the listener to the listeners collection",(function(){var e=GMaps.on("click",o,l.marker.onclick);expect(o.__e3_.click[e.id]).toBeDefined(),expect(o.__e3_.click[e.id]).toEqual(e)}))})),describe("To a line",(function(){it("should add the listener to the listeners collection",(function(){var e=GMaps.on("click",n,l.line.onclick);expect(n.__e3_.click[e.id]).toBeDefined(),expect(n.__e3_.click[e.id]).toEqual(e)}))})),describe("To a polygon",(function(){it("should add the listener to the listeners collection",(function(){var e=GMaps.on("click",t,l.polygon.onclick);expect(t.__e3_.click[e.id]).toBeDefined(),expect(t.__e3_.click[e.id]).toEqual(e)}))})),describe("registering non custom events",(function(){it("custom registered_events should not exist",(function(){e.on("bounds_changed",(function(){})),expect(e.registered_events.bounds_changed).not.toBeDefined()})),it("delegates the handler to google.map",(function(){var o=!1;e.on("bounds_changed",(function(){o=!0})),google.maps.event.trigger(e.map,"bounds_changed"),expect(o).toBe(!0)}))})),describe("removing non custom events",(function(){it("removes handler from google.map",(function(){var o=!0;e.on("bounds_changed",(function(){o=!1})),e.off("bounds_changed"),google.maps.event.trigger(e.map,"bounds_changed"),expect(o).toBe(!0)}))}))})),describe("for GMaps events",(function(){beforeEach((function(){c={marker_added:function(){console.log("callbacks_gmaps.marker_added called")},marker_removed:function(){console.log("callbacks_gmaps.marker_removed called")},polyline_added:function(){console.log("callbacks_gmaps.polyline_added called")},polyline_removed:function(){console.log("callbacks_gmaps.polyline_removed called")},polygon_added:function(){console.log("callbacks_gmaps.polygon_added called")},polygon_removed:function(){console.log("callbacks_gmaps.polygon_removed called")}},spyOn(c,"marker_added").and.callThrough(),spyOn(c,"marker_removed").and.callThrough(),spyOn(c,"polyline_added").and.callThrough(),spyOn(c,"polyline_removed").and.callThrough(),spyOn(c,"polygon_added").and.callThrough(),spyOn(c,"polygon_removed").and.callThrough()})),describe("#marker_added",(function(){beforeEach((function(){r=GMaps.on("marker_added",e,c.marker_added)})),it("should add the listener to the listeners collection",(function(){expect(e.registered_events.marker_added[0]).toEqual(r)})),it("should trigger the listener created",(function(){a=a||e.addMarker({lat:-12.0433,lng:-77.0273,title:"New marker"}),expect(c.marker_added).toHaveBeenCalled()})),afterEach((function(){GMaps.off("marker_added",e)}))})),describe("#marker_removed",(function(){beforeEach((function(){s=GMaps.on("marker_removed",e,c.marker_removed)})),it("should add the listener to the listeners collection",(function(){expect(e.registered_events.marker_removed[0]).toEqual(s)})),it("should trigger the listener created",(function(){e.removeMarker(a),expect(c.marker_removed).toHaveBeenCalled()})),afterEach((function(){GMaps.off("marker_removed",e)}))})),describe("#polyline_added",(function(){beforeEach((function(){p=GMaps.on("polyline_added",e,c.polyline_added)})),it("should add the listener to the listeners collection",(function(){expect(e.registered_events.polyline_added[0]).toEqual(p)})),it("should trigger the listener created",(function(){i=i||e.drawPolyline({path:[[-12.042,-77.0247],[-12.0544,-77.0102],[-12.0751,-77.0903],[-12.0759,-77.0276],[-12.0763,-77.0279],[-12.0768,-77.0289],[-12.0885,-77.0241],[-12.0908,-77.0227]],strokeColor:"#271804",strokeOpacity:.1,strokeWeight:1}),expect(c.polyline_added).toHaveBeenCalled()})),afterEach((function(){GMaps.off("polyline_added",e)}))})),describe("#polyline_removed",(function(){beforeEach((function(){u=GMaps.on("polyline_removed",e,c.polyline_removed)})),it("should add the listener to the listeners collection",(function(){expect(e.registered_events.polyline_removed[0]).toEqual(u)})),it("should trigger the listener created",(function(){e.removePolyline(i),expect(c.polyline_removed).toHaveBeenCalled()})),afterEach((function(){GMaps.off("polyline_removed",e)}))})),describe("#polygon_added",(function(){beforeEach((function(){g=GMaps.on("polygon_added",e,c.polygon_added)})),it("should add the listener to the listeners collection",(function(){expect(e.registered_events.polygon_added[0]).toEqual(g)})),it("should trigger the listener created",(function(){d=d||e.drawPolygon({paths:[[-12.0203,-77.0137],[-12.0402,-77.0109],[-12.05,-77.0144],[-12.0848,-77.0115]],strokeColor:"#D32559",strokeOpacity:.7,strokeWeight:8,fillColor:"#D32559",fillOpacity:.6}),expect(c.polygon_added).toHaveBeenCalled()})),afterEach((function(){GMaps.off("polygon_added",e)}))})),describe("#polygon_removed",(function(){beforeEach((function(){f=GMaps.on("polygon_removed",e,c.polygon_removed)})),it("should add the listener to the listeners collection",(function(){expect(e.registered_events.polygon_removed[0]).toEqual(f)})),it("should trigger the listener created",(function(){e.removePolygon(d),expect(c.polygon_removed).toHaveBeenCalled()})),afterEach((function(){GMaps.off("polygon_removed",e)}))}))}))}));